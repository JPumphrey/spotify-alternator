<!DOCTYPE html>
<html>
<head>
  <title>Spotify Controller</title>
</head>
<body>
  <h1>Spotify Controller</h1>

  <script src="token.js"></script>
  <script>
    function create_playlist() {
        var playlist_id = document.getElementById("playlist_id").value 
        var song_id = document.getElementById("song_uri").value 

        fetch(`https://api.spotify.com/v1/playlists/${playlist_id}`, {
        method: 'GET',
        headers: {
            'Authorization': `Bearer ${token}`
        },
        }).then(response => {
            return response.json()
        }).then(data => {
            console.log(data.id)
            return data
        }).then(playlist => {
            fetch(`https://api.spotify.com/v1/playlists/${playlist_id}/tracks`, {
            method: 'GET',
            headers: {
                'Authorization': `Bearer ${token}`
            },
            }).then(response => {
                return response.json()
            }).then(data => {
                console.log(data)
                return data.items
            }).then(tracks => {
                fetch(`https://api.spotify.com/v1/me`, {
                method: 'GET',
                headers: {
                    'Authorization': `Bearer ${token}`
                },
                }).then(response => {
                    return response.json()
                }).then(data => {
                    console.log(data.id)
                    return data.id
                }).then(user_id => {
                    fetch(`https://api.spotify.com/v1/users/${user_id}/playlists`, {
                        method: 'POST',
                        headers: {
                            'Authorization': `Bearer ${token}`,
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            name: playlist.name + "--mix",
                            public: false
                        })
                    }).then(response => {
                        return response.json()
                    }).then(data => {
                        console.log(data)
                        return data
                    }).then(new_playlist => {
                        fetch(`https://api.spotify.com/v1/playlists/${new_playlist.id}/tracks`, {
                            method: 'POST',
                            headers: {
                                'Authorization': `Bearer ${token}`,
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify({
                                uris: tracks.map(track => track.track.uri)
                            })
                        }).then(response => {
                            return response.json()
                        }).then(data => {
                            console.log(data)
                            return data
                        })
                    })
                })
            });
        });
    }
  </script>

<form id="form">
        Song uri: <input type="text" id="song_uri"><br/>
        Playlist uri: <input type="text" id="playlist_id"><br/>
        <input type="button" onclick="create_playlist()" value="Create playlist">
</form>
</body>
</html>